{
  "name": "Email Telegram Complete System",
  "nodes": [
    {
      "parameters": {
        "options": {
          "forceReconnect": 60
        }
      },
      "id": "email-trigger",
      "name": "Email Trigger",
      "type": "n8n-nodes-base.emailReadImap",
      "typeVersion": 2,
      "position": [250, 300]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst timestamp = Date.now().toString(36);\nconst random = Math.random().toString(36).substring(2, 5);\nconst shortId = `${timestamp}${random}`;\n\nconst emailData = {\n  id: shortId,\n  messageId: items[0].json.metadata[\"message-id\"],\n  from: items[0].json.from,\n  fromName: items[0].json.from,\n  subject: items[0].json.subject || \"Sans objet\",\n  body: items[0].json.textPlain || items[0].json.textHtml.replace(/<[^>]*>/g, \"\"),\n  date: new Date(items[0].json.date).toLocaleString(\"fr-FR\"),\n  hasAttachments: items[0].json.attachments && items[0].json.attachments.length > 0\n};\n\nreturn { emailData };"
      },
      "id": "format-email",
      "name": "Format Email",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Tu es un assistant qui r√©sum√© les mails. Voici les infos :\nID : {{ $json.emailData.id }}\nDe : {{ $json.emailData.from }}\nNom : {{ $json.emailData.fromName }}\nSujet : {{ $json.emailData.subject }}\nCorps : {{ $json.emailData.body }}\nDate : {{ $json.emailData.date }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Tu es un assistant agent IA qui r√©sume les mails pour les envoyer dans un message Telegram.\n\nLe but est de savoir qui a envoy√© le mail, et de m'annoncer le message g√©n√©ral en une phrase. S'il y a des informations importantes, il faut me les donner aussi.\n\nIMPORTANT : Tu re√ßois un ID court unique avec chaque mail. Tu DOIS utiliser cet ID pour :\n1. L'enregistrer en base de donn√©es\n2. Le mentionner dans ta r√©ponse pour que n8n puisse cr√©er le bouton \"R√©pondre\"\n\nUtilise l'outil \"NewMail\" pour noter les informations du mail en base comme ceci :\nID : {{L'ID court fourni}}\nNom : Le nom de l'exp√©diteur\nEmail Re√ßu : Sujet + Corps du mail (sans signatures ni liens tracking)\nR√©ponse : NULL\nIt√©rations : 1\nEmail Pr√©par√© : NULL\nR√©pondu : NULL\nDate : La date du mail\n\nFormat de ta r√©ponse OBLIGATOIRE :\n{\n  \"ID\": \"{{id_court}}\",\n  \"message\": \"{{Nom}} t'a envoy√© un mail √† {{heure}} le {{date}}. Son objet √©tait {{sujet}}. Voici ce qu'il a dit : {{corps_du_message_sans_signature}}\"\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [650, 300],
      "id": "agent-summarize"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [650, 500],
      "id": "openai-model"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1DaTX5afNnh2g3xrANNqIwG_axFHe87IPGQTnsZQqWJs",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID": "={{ $fromAI('ID', '', 'string') }}",
            "Nom": "={{ $fromAI('Nom', '', 'string') }}",
            "Email Re√ßu": "={{ $fromAI('Email_Re_u', '', 'string') }}",
            "R√©ponse": "={{ $fromAI('R_ponse', '', 'string') }}",
            "Email Pr√©par√©": "={{ $fromAI('Email_Pr_par_', '', 'string') }}",
            "R√©pondu": "={{ $fromAI('R_pondu', '', 'string') }}",
            "Date": "={{ $fromAI('Date', '', 'string') }}",
            "Iterations": "={{ $fromAI('Iterations', '', 'string') }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "ID",
              "displayName": "ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Nom",
              "displayName": "Nom",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Email Re√ßu",
              "displayName": "Email Re√ßu",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "R√©ponse",
              "displayName": "R√©ponse",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Iterations",
              "displayName": "Iterations",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Email Pr√©par√©",
              "displayName": "Email Pr√©par√©",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "R√©pondu",
              "displayName": "R√©pondu",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "Date",
              "displayName": "Date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [850, 500],
      "id": "newmail-tool"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"ID\": \"id du mail\",\n  \"message\": \"ton message\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [1050, 500],
      "id": "output-parser"
    },
    {
      "parameters": {
        "chatId": "621354826",
        "text": "={{ $json.output.message }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "R√©pondre",
                    "additionalFields": {
                      "callback_data": "=reply_{{ $json.output.ID }}"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "id": "send-telegram",
      "name": "Send to Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "updates": ["callback_query"],
        "additionalFields": {}
      },
      "id": "callback-trigger",
      "name": "Telegram Callback",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [250, 700]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.callback_query.data}}",
              "operation": "startsWith",
              "value2": "reply_"
            }
          ]
        }
      },
      "id": "if-reply",
      "name": "IF Reply",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 700]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.callback_query.data}}",
              "operation": "startsWith",
              "value2": "edit_"
            }
          ]
        }
      },
      "id": "if-edit",
      "name": "IF Edit",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 800]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.callback_query.data}}",
              "operation": "startsWith",
              "value2": "send_"
            }
          ]
        }
      },
      "id": "if-send",
      "name": "IF Send",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 900]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst callbackData = items[0].json.callback_query.data;\nconst mailId = callbackData.replace('reply_', '');\nconst chatId = items[0].json.callback_query.message.chat.id;\nconst queryId = items[0].json.callback_query.id;\nconst firstName = items[0].json.callback_query.from.first_name || 'Utilisateur';\n\nreturn [{\n  json: {\n    mailId,\n    chatId,\n    queryId,\n    firstName,\n    messageId: items[0].json.callback_query.message.message_id\n  }\n}];"
      },
      "id": "extract-reply",
      "name": "Extract Reply Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 700]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$json.chatId}}",
        "text": "üìß R√©pondre au mail [{{$json.mailId}}]\n\n{{$json.firstName}}, tapez ou dictez votre r√©ponse ci-dessous :",
        "replyMarkup": "forceReply",
        "additionalFields": {
          "force_reply": true,
          "input_field_placeholder": "Tapez votre r√©ponse..."
        }
      },
      "id": "force-keyboard",
      "name": "Force Keyboard",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [850, 700]
    },
    {
      "parameters": {
        "resource": "callback",
        "operation": "answerQuery",
        "queryId": "={{$json.queryId}}",
        "text": "‚úÖ Tapez votre r√©ponse",
        "additionalFields": {
          "show_alert": false
        }
      },
      "id": "answer-callback",
      "name": "Answer Callback",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1050, 700]
    },
    {
      "parameters": {
        "updates": ["message"],
        "additionalFields": {}
      },
      "id": "message-trigger",
      "name": "Telegram Message",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [250, 1100]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.message.reply_to_message ? 'true' : 'false'}}",
              "value2": "true"
            },
            {
              "value1": "={{$json.message.reply_to_message.text}}",
              "operation": "contains",
              "value2": "R√©pondre au mail"
            }
          ]
        },
        "combineOperation": "and"
      },
      "id": "if-is-reply",
      "name": "IF Is Reply",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 1100]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.message.reply_to_message ? 'true' : 'false'}}",
              "value2": "true"
            },
            {
              "value1": "={{$json.message.reply_to_message.text}}",
              "operation": "contains",
              "value2": "Modifier le brouillon"
            }
          ]
        },
        "combineOperation": "and"
      },
      "id": "if-is-edit",
      "name": "IF Is Edit",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 1200]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst message = items[0].json.message;\nconst replyToText = message.reply_to_message.text;\nconst mailIdMatch = replyToText.match(/\\[([^\\]]+)\\]/);\nconst mailId = mailIdMatch ? mailIdMatch[1] : null;\n\nlet userResponse = message.text || '';\nif (message.voice) {\n  userResponse = \"[Message vocal √† transcrire]\";\n}\n\nreturn [{\n  json: {\n    mailId,\n    userResponse,\n    chatId: message.chat.id,\n    userId: message.from.id,\n    userName: message.from.first_name\n  }\n}];"
      },
      "id": "extract-response",
      "name": "Extract Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 1100]
    },
    {
      "parameters": {
        "operation": "lookup",
        "documentId": {
          "__rl": true,
          "value": "1DaTX5afNnh2g3xrANNqIwG_axFHe87IPGQTnsZQqWJs",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "lookupColumn": "ID",
        "lookupValue": "={{$json.mailId}}",
        "options": {
          "returnAllMatches": false
        }
      },
      "id": "lookup-email",
      "name": "Lookup Email",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [850, 1100]
    },
    {
      "parameters": {
        "promptType": "define", 
        "text": "=Email original :\nDe : {{ $json[\"Nom\"] }}\nSujet : {{ $json[\"Email Re√ßu\"] }}\n\nR√©ponse demand√©e par l'utilisateur :\n{{ $node[\"Extract Response\"].json.userResponse }}\n\nG√©n√®re une r√©ponse email professionnelle et polie bas√©e sur la demande de l'utilisateur.",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "Tu es un assistant qui r√©dige des r√©ponses professionnelles √† des emails.\n\n√Ä partir de l'email original et de la demande de l'utilisateur, tu dois g√©n√©rer un brouillon de r√©ponse email professionnel.\n\nUtilise l'outil \"Update Draft\" pour mettre √† jour le Google Sheet avec :\n- Email Pr√©par√© : Le brouillon g√©n√©r√©\n- R√©ponse : La demande originale de l'utilisateur  \n- Iterations : Incr√©menter de 1\n\nFormat de sortie OBLIGATOIRE :\n{\n  \"brouillon\": \"Le texte du brouillon de r√©ponse\",\n  \"mailId\": \"{{mailId}}\"\n}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [1050, 1100],
      "id": "generate-draft"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list", 
          "value": "gpt-4"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [1050, 1300],
      "id": "openai-draft"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1DaTX5afNnh2g3xrANNqIwG_axFHe87IPGQTnsZQqWJs",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columnToMatchOn": "ID",
        "valueToMatchOn": "={{$fromAI('mailId', '', 'string')}}",
        "fieldsUi": {
          "values": [
            {
              "column": "Email Pr√©par√©",
              "fieldValue": "={{$fromAI('brouillon', '', 'string')}}"
            },
            {
              "column": "R√©ponse", 
              "fieldValue": "={{$node[\"Extract Response\"].json.userResponse}}"
            },
            {
              "column": "Iterations",
              "fieldValue": "={{(parseInt($json[\"Iterations\"]) || 0) + 1}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleSheetsTool",
      "typeVersion": 4.7,
      "position": [1250, 1300],
      "id": "update-draft"
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n  \"brouillon\": \"Le texte du brouillon\",\n  \"mailId\": \"id du mail\"\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [1450, 1300],
      "id": "draft-parser"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$node[\"Extract Response\"].json.chatId}}",
        "text": "üìù Brouillon de r√©ponse :\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n{{$json.output.brouillon}}\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "‚úèÔ∏è Modifier",
                    "additionalFields": {
                      "callback_data": "=edit_{{$node[\"Extract Response\"].json.mailId}}"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "üìß Brouillon",
                    "additionalFields": {
                      "callback_data": "=draft_{{$node[\"Extract Response\"].json.mailId}}"
                    }
                  },
                  {
                    "text": "‚úÖ Envoyer",
                    "additionalFields": {
                      "callback_data": "=send_{{$node[\"Extract Response\"].json.mailId}}"
                    }
                  }
                ]
              }
            }
          ]
        }
      },
      "id": "send-draft",
      "name": "Send Draft",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1250, 1100]
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst callbackData = items[0].json.callback_query.data;\nconst action = callbackData.split('_')[0];\nconst mailId = callbackData.replace(action + '_', '');\nconst chatId = items[0].json.callback_query.message.chat.id;\nconst queryId = items[0].json.callback_query.id;\n\nreturn [{\n  json: {\n    action,\n    mailId,\n    chatId,\n    queryId\n  }\n}];"
      },
      "id": "extract-action",
      "name": "Extract Action",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 800]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage", 
        "chatId": "={{$json.chatId}}",
        "text": "‚úèÔ∏è Modifier le brouillon [{{$json.mailId}}]\n\nTapez vos modifications ci-dessous :",
        "replyMarkup": "forceReply",
        "additionalFields": {
          "force_reply": true,
          "input_field_placeholder": "Tapez vos modifications..."
        }
      },
      "id": "force-edit",
      "name": "Force Edit",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [850, 800]
    },
    {
      "parameters": {
        "resource": "callback",
        "operation": "answerQuery",
        "queryId": "={{$json.queryId}}",
        "text": "‚úèÔ∏è Modifiez le brouillon"
      },
      "id": "answer-edit",
      "name": "Answer Edit",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1050, 800]
    },
    {
      "parameters": {
        "operation": "lookup",
        "documentId": {
          "__rl": true,
          "value": "1DaTX5afNnh2g3xrANNqIwG_axFHe87IPGQTnsZQqWJs",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "lookupColumn": "ID",
        "lookupValue": "={{$json.mailId}}",
        "options": {
          "returnAllMatches": false
        }
      },
      "id": "lookup-send",
      "name": "Lookup for Send",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [850, 900]
    },
    {
      "parameters": {
        "sendTo": "={{$json[\"Nom\"]}}",
        "subject": "Re: {{$json[\"Email Re√ßu\"]}}",
        "emailType": "text",
        "message": "={{$json[\"Email Pr√©par√©\"]}}",
        "options": {}
      },
      "id": "send-email",
      "name": "Send Email",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2,
      "position": [1050, 900]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "1DaTX5afNnh2g3xrANNqIwG_axFHe87IPGQTnsZQqWJs",
          "mode": "list"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list"
        },
        "columnToMatchOn": "ID",
        "valueToMatchOn": "={{$node[\"Extract Action\"].json.mailId}}",
        "fieldsUi": {
          "values": [
            {
              "column": "R√©pondu",
              "fieldValue": "OUI"
            },
            {
              "column": "Date",
              "fieldValue": "={{new Date().toISOString()}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4,
      "position": [1250, 900],
      "id": "update-sent"
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$node[\"Extract Action\"].json.chatId}}",
        "text": "‚úÖ Email envoy√© avec succ√®s !\n\n√Ä : {{$node[\"Lookup for Send\"].json[\"Nom\"]}}\nSujet : Re: {{$node[\"Lookup for Send\"].json[\"Email Re√ßu\"]}}"
      },
      "id": "confirm-sent",
      "name": "Confirm Sent",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1450, 900]
    },
    {
      "parameters": {
        "resource": "callback",
        "operation": "answerQuery",
        "queryId": "={{$node[\"Extract Action\"].json.queryId}}",
        "text": "‚úÖ Email envoy√© !"
      },
      "id": "answer-send",
      "name": "Answer Send",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1450, 950]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{$json.callback_query.data}}",
              "operation": "startsWith",
              "value2": "draft_"
            }
          ]
        }
      },
      "id": "if-draft",
      "name": "IF Draft",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [450, 1000]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "sendMessage",
        "chatId": "={{$json.chatId}}",
        "text": "üìß Brouillon sauvegard√© !\n\nVous pourrez l'envoyer plus tard depuis Gmail."
      },
      "id": "confirm-draft",
      "name": "Confirm Draft",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [850, 1000]
    },
    {
      "parameters": {
        "resource": "callback",
        "operation": "answerQuery",
        "queryId": "={{$json.queryId}}",
        "text": "üìß Sauvegard√© en brouillon"
      },
      "id": "answer-draft",
      "name": "Answer Draft",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1050, 1000]
    }
  ],
  "connections": {
    "Email Trigger": {
      "main": [
        [
          {
            "node": "Format Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Email": {
      "main": [
        [
          {
            "node": "Envoyer Mails",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agent-summarize": {
      "main": [
        [
          {
            "node": "Send to Telegram",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai-model": {
      "ai_languageModel": [
        [
          {
            "node": "agent-summarize",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "newmail-tool": {
      "ai_tool": [
        [
          {
            "node": "agent-summarize",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "output-parser": {
      "ai_outputParser": [
        [
          {
            "node": "agent-summarize",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Callback": {
      "main": [
        [
          {
            "node": "IF Reply",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Edit",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Send",
            "type": "main", 
            "index": 0
          },
          {
            "node": "IF Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Reply": {
      "main": [
        [
          {
            "node": "Extract Reply Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Reply Data": {
      "main": [
        [
          {
            "node": "Force Keyboard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Force Keyboard": {
      "main": [
        [
          {
            "node": "Answer Callback",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Message": {
      "main": [
        [
          {
            "node": "IF Is Reply",
            "type": "main",
            "index": 0
          },
          {
            "node": "IF Is Edit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Is Reply": {
      "main": [
        [
          {
            "node": "Extract Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Response": {
      "main": [
        [
          {
            "node": "Lookup Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lookup Email": {
      "main": [
        [
          {
            "node": "Generate Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "generate-draft": {
      "main": [
        [
          {
            "node": "Send Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "openai-draft": {
      "ai_languageModel": [
        [
          {
            "node": "generate-draft",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "update-draft": {
      "ai_tool": [
        [
          {
            "node": "generate-draft", 
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "draft-parser": {
      "ai_outputParser": [
        [
          {
            "node": "generate-draft",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "IF Edit": {
      "main": [
        [
          {
            "node": "Extract Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Action": {
      "main": [
        [
          {
            "node": "Force Edit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Force Edit": {
      "main": [
        [
          {
            "node": "Answer Edit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Is Edit": {
      "main": [
        [
          {
            "node": "Extract Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Send": {
      "main": [
        [
          {
            "node": "Extract Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Action": {
      "main": [
        [
          {
            "node": "Lookup for Send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Lookup for Send": {
      "main": [
        [
          {
            "node": "Send Email",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Email": {
      "main": [
        [
          {
            "node": "Update Sent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Sent": {
      "main": [
        [
          {
            "node": "Confirm Sent",
            "type": "main",
            "index": 0
          },
          {
            "node": "Answer Send",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IF Draft": {
      "main": [
        [
          {
            "node": "Extract Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Action": {
      "main": [
        [
          {
            "node": "Confirm Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Confirm Draft": {
      "main": [
        [
          {
            "node": "Answer Draft",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionTimeout": 120
  }
}