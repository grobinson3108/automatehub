{
  "name": "TARS - LinkedIn Comment Automation",
  "nodes": [
    {
      "parameters": {
        "url": "https://api.linkedin.com/v2/socialActions",
        "authentication": "oAuth2",
        "httpMethod": "GET",
        "options": {
          "queryParameters": {
            "postUrn": "={{$node.Webhook.json.postUrn}}"
          }
        }
      },
      "id": "linkedin-api",
      "name": "Get LinkedIn Comments",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [500, 300]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "tars-comment-webhook",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook",
      "name": "LinkedIn Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [300, 300],
      "webhookId": "tars-linkedin-comments"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{$node['Get LinkedIn Comments'].json.activity}}",
              "rightValue": "comment",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "filter-comments",
      "name": "Filter Comments Only",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [700, 300]
    },
    {
      "parameters": {
        "jsCode": "// Analyser le commentaire pour d√©tecter les mots-cl√©s TARS\nconst comment = $input.first().json.message;\nconst keywords = ['TARS', 'workflow', 'automatisation', 'automation', 'gratuit', 'free'];\n\nconst hasKeyword = keywords.some(keyword => \n  comment.toLowerCase().includes(keyword.toLowerCase())\n);\n\nconst userData = {\n  userId: $input.first().json.actor.id,\n  userName: $input.first().json.actor.firstName + ' ' + $input.first().json.actor.lastName,\n  comment: comment,\n  timestamp: new Date().toISOString(),\n  hasKeyword: hasKeyword,\n  postId: $input.first().json.object\n};\n\nreturn userData;"
      },
      "id": "analyze-comment",
      "name": "Analyze Comment",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 250]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "leftValue": "={{$node['Analyze Comment'].json.hasKeyword}}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equal"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-keywords",
      "name": "Check Keywords",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1100, 250]
    },
    {
      "parameters": {
        "resource": "message",
        "operation": "send",
        "recipientId": "={{$node['Analyze Comment'].json.userId}}",
        "message": "ü§ñ Salut {{$node['Analyze Comment'].json.userName}} !\n\nMerci pour ton commentaire sur TARS ! üöÄ\n\nComme promis, voici ton workflow TARS gratuit :\nüëâ [LIEN TELECHARGEMENT]\n\nüéØ OFFRE SP√âCIALE pour toi :\nPuisque tu t'int√©resses √† l'automatisation, j'ai une offre exclusive...\n\n‚ú® Pack TARS Premium (30 workflows) : 29‚Ç¨ au lieu de 94‚Ç¨\n‚è∞ Valable 2h seulement !\n\nüëâ Clique ici : https://automatehub.fr/tars-pack1\n\nQuestions ? R√©ponds directement √† ce message !\n\nü§ñ TARS",
        "additionalFields": {}
      },
      "id": "send-dm",
      "name": "Send LinkedIn DM",
      "type": "n8n-nodes-base.linkedIn",
      "typeVersion": 1,
      "position": [1300, 200]
    },
    {
      "parameters": {
        "operation": "create",
        "table": "tars_leads",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "user_id": "={{$node['Analyze Comment'].json.userId}}",
            "user_name": "={{$node['Analyze Comment'].json.userName}}",
            "comment": "={{$node['Analyze Comment'].json.comment}}",
            "post_id": "={{$node['Analyze Comment'].json.postId}}",
            "timestamp": "={{$node['Analyze Comment'].json.timestamp}}",
            "dm_sent": "=true",
            "status": "=lead"
          }
        },
        "options": {}
      },
      "id": "save-lead",
      "name": "Save Lead to Database",
      "type": "n8n-nodes-base.mysql",
      "typeVersion": 2.2,
      "position": [1300, 350]
    },
    {
      "parameters": {
        "operation": "create",
        "table": "tars_analytics",
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "event_type": "=comment_detected",
            "user_id": "={{$node['Analyze Comment'].json.userId}}",
            "post_id": "={{$node['Analyze Comment'].json.postId}}",
            "timestamp": "={{$node['Analyze Comment'].json.timestamp}}",
            "data": "={{JSON.stringify($node['Analyze Comment'].json)}}"
          }
        },
        "options": {}
      },
      "id": "track-analytics",
      "name": "Track Analytics",
      "type": "n8n-nodes-base.mysql",
      "typeVersion": 2.2,
      "position": [1500, 250]
    },
    {
      "parameters": {
        "authentication": "oAuth2",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C07XXXXXXXXX",
          "mode": "list"
        },
        "text": "üéØ Nouveau lead TARS !\n\nüë§ {{$node['Analyze Comment'].json.userName}}\nüí¨ Commentaire : {{$node['Analyze Comment'].json.comment}}\nüìß DM envoy√© automatiquement\n‚è∞ {{$node['Analyze Comment'].json.timestamp}}",
        "otherOptions": {}
      },
      "id": "slack-notification",
      "name": "Notify Team Slack",
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.1,
      "position": [1500, 150]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"status\": \"success\",\n  \"message\": \"Comment processed\",\n  \"lead_created\": true,\n  \"dm_sent\": true\n}",
        "options": {}
      },
      "id": "response",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1700, 250]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"status\": \"ignored\",\n  \"message\": \"No TARS keywords found\"\n}",
        "options": {}
      },
      "id": "ignore-response",
      "name": "Ignore Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [1300, 450]
    }
  ],
  "connections": {
    "LinkedIn Webhook": {
      "main": [
        [
          {
            "node": "Get LinkedIn Comments",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get LinkedIn Comments": {
      "main": [
        [
          {
            "node": "Filter Comments Only",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Comments Only": {
      "main": [
        [
          {
            "node": "Analyze Comment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Comment": {
      "main": [
        [
          {
            "node": "Check Keywords",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Keywords": {
      "main": [
        [
          {
            "node": "Send LinkedIn DM",
            "type": "main",
            "index": 0
          },
          {
            "node": "Save Lead to Database",
            "type": "main",
            "index": 0
          },
          {
            "node": "Notify Team Slack",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Ignore Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send LinkedIn DM": {
      "main": [
        [
          {
            "node": "Track Analytics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Lead to Database": {
      "main": [
        [
          {
            "node": "Track Analytics",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Track Analytics": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2024-12-29T14:30:00.000Z",
  "updatedAt": "2024-12-29T14:30:00.000Z",
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "createdAt": "2024-12-29T14:30:00.000Z",
      "updatedAt": "2024-12-29T14:30:00.000Z",
      "id": "tars",
      "name": "TARS"
    },
    {
      "createdAt": "2024-12-29T14:30:00.000Z",
      "updatedAt": "2024-12-29T14:30:00.000Z",
      "id": "linkedin",
      "name": "LinkedIn"
    }
  ],
  "pinData": {},
  "versionId": "1"
}